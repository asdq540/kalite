<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kalite Kontrol Paneli</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>

<style>
body { background: #f1f3f5; padding: 20px; font-family: "Segoe UI", sans-serif; }
.card-header { font-weight: 600; font-size: 18px; }
.table img { max-height: 60px; border-radius: 6px; }
</style>
</head>
<body>

<div class="container mt-4">

  <!-- Veri Tablosu -->
  <div class="card mb-5 shadow-sm">
    <div class="card-header bg-primary text-white">
      Kalite Veri Tablosu
    </div>
    <div class="card-body">
      <input type="text" id="searchData" class="form-control mb-3" placeholder="Tabloda ara...">
      <table id="dataTable" class="table table-bordered table-striped" style="width:100%">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Fotoğraf Tablosu -->
  <div class="card mb-5 shadow-sm">
    <div class="card-header bg-success text-white">
      Fotoğraf Tablosu
    </div>
    <div class="card-body">
      <input type="text" id="searchFoto" class="form-control mb-3" placeholder="Fotoğraflarda ara...">
      <table id="fotoTable" class="table table-bordered table-striped" style="width:100%">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBWFSVSD6NvBNqC8me1le_unCCLOKIOIS2DfZFXUTji0MHC7SaWNIy4a0Laob9xOiAJyPnp7LuZ1R-/pub?output=csv";

function loadTables() {
  fetch(sheetUrl)
    .then(response => response.text())
    .then(csvText => {
      const data = Papa.parse(csvText, { header: false }).data;

      // --- Veri Tablosu (J-Q sütunları) ---
      const dataHeaders = data[0].slice(9, 17); // J-Q
      const dataRows = data.slice(1).map(row => row.slice(9, 17));

      $('#dataTable').DataTable({
        destroy: true,
        data: dataRows,
        columns: dataHeaders.map(h => ({ title: h })),
        pageLength: 20,
        ordering: false,
        language: {
          search: "Ara:",
          paginate: { first: "İlk", last: "Son", next: ">", previous: "<" },
          info: "_TOTAL_ kayıttan _START_ - _END_ gösteriliyor"
        }
      });

      // --- Fotoğraf Tablosu (A-G sütunları) ---
      const fotoHeaders = data[0].slice(0, 7); // A-G
      const fotoRows = data.slice(1).map(row => {
        const rowCopy = row.slice(0, 7);
        // F sütununu (5. index) img tag olarak değiştir
        if (rowCopy[5]) {
          rowCopy[5] = `<img src="${rowCopy[5]}" alt="Fotoğraf">`;
        }
        return rowCopy;
      });

      $('#fotoTable').DataTable({
        destroy: true,
        data: fotoRows,
        columns: fotoHeaders.map(h => ({ title: h })),
        pageLength: 20,
        ordering: false,
        language: {
          search: "Ara:",
          paginate: { first: "İlk", last: "Son", next: ">", previous: "<" },
          info: "_TOTAL_ kayıttan _START_ - _END_ gösteriliyor"
        }
      });
    });
}

// Arama inputları ile filtreleme
$(document).ready(function() {
  loadTables();

  $('#searchData').on('keyup', function() {
    $('#dataTable').DataTable().search(this.value).draw();
  });

  $('#searchFoto').on('keyup', function() {
    $('#fotoTable').DataTable().search(this.value).draw();
  });
});
</script>

</body>
</html>
